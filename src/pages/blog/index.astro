---
import Base from '../../layouts/Base.astro';
import BaseLink from '../../components/BaseLink.astro';
import { supabase } from '../../lib/supabase';

const { data: posts, error } = await supabase
  .from('posts')
  .select('slug, title, created_at')
  .order('created_at', { ascending: false });

if (error) {
  console.error('Error loading posts:', error);
}
---

<Base title="Blog">
  <h1 class="text-3xl font-semibold mb-6">Blog</h1>

  {posts?.length ? (
    <ul class="space-y-6">
      {posts.map((post) => (
        <li>
          <BaseLink
            href={`blog/${post.slug}/`}
            class="text-blue-400 hover:underline text-lg"
          >
            {post.title}
          </BaseLink>

          <p class="text-xs text-zinc-500 mt-1">
            {new Date(post.created_at).toLocaleDateString()}
          </p>
        </li>
      ))}
    </ul>
  ) : (
    <p>No posts yet.</p>
  )}
</Base>
